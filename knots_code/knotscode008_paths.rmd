---
editor_options: 
  chunk_output_type: console
---

```{r load_libs}
source("libs.R")
library(readr);library(viridis)

```

```{r load_data}
#'load filtered data: varx and var y below 10 each, speed below 15
load("k2.1_flights.rdata")
```

```{r make_lines}
#'use same template as k2-data
k2.lines = k2.1 %>% arrange(id, ts) %>% dlply(c("id")) %>% 
  map(function(x) Line(cbind(x$X, x$Y)))

k2.lines = k2.lines %>% 
  map(function(x) Lines(x, ID = "a"))

for(i in 1:length(k2.lines)){
  k2.lines[[i]]@ID = names(k2.lines)[i]
}
```

```{r make_spatial_lines}
names = names(k2.lines)

#'use the UTM 31N CRS
k2.lines = SpatialLines(k2.lines, proj4string = CRS("+proj=utm +zone=31 +ellps=WGS84 +datum=WGS84 +units=m +no_defs
+towgs84=0,0,0"))

library(stringi)

data = data_frame(id = 1:length(k2.lines), names2 = substr(names,1,3)#, days = substr(names,5,5)
                  )

rownames(data) = names

k2.lines = SpatialLinesDataFrame(k2.lines, data = data)

#'export
library(rgdal)
writeOGR(k2.lines, dsn = "knots_data/knots_spatials/", layer = "k2.1_clean_5day_lines", driver = "ESRI Shapefile", overwrite_layer = T)
```


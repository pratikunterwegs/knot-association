---
editor_options: 
  chunk_output_type: console
---
```{r}
source("libs.R")
library(adehabitatLT)

library(segclust2d)

```

```{r load_data}
#load data
load("knots_data/knots01_for_residence_segments.rdata")
```

```{r prep_for_segments}
#'prep data, remove point with fpt less than 10 mins
data.prep = data %>% filter(fpt > 10/60) %>% dlply("id.ht")

#'remove tracks with less than 60 positions remaining , ie, data.prep with less than 60 positions
data.prep = data.prep[unlist(map(data.prep, nrow))>= 60]
```

```{r segment_lavielle_segclust2d}
#'segment using lavielle method
data.seg = data.prep %>%
  map(function(x){
    segmentation(x, lmin = 10, Kmax = 30, type = "behavior", seg.var = "fpt")
  })
```

```{r find_segs}
#'find the segs in data.seg
data.segpaths = data.seg %>%
  map(function(x){
    augment(x)
  })
```

```{r save_data}
save(data.segpaths, file = "knots_data/knots01_segmented.rdata")
```

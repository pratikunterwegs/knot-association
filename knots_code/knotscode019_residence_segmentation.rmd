---
chunk_output_type: console
---
```{r}
#'source libs
source("libs.R")
library(readr)
```

```{r}
#'read in segmented data
load("knots_data/segmented_residence_data/fpt_var_segmented_data.rdata")

data.segments = files %>%
  map(function(x) read_csv(x, col_names = F))

#'load prepped data
load("knots_data/knots01_for_residence_segments.rdata")
```

```{r}
#'identify segments where there is no data, ie, no change in segments
#'assign id.ht to the dfs
for(i in 1:length(data.segpaths)){
  for (j in 1:length(data.segpaths[[i]])){
  data.segpaths[[i]][[j]]$seg = j
  data.segpaths[[i]][[j]]$id.ht = names(data.segpaths)[i]
  }
}

#'bind rows overall
data.segmented = data.segpaths %>% 
  map(function(x){
    x %>% map(unclass) %>% map(as.data.frame) %>% 
      bind_rows()
  }) %>% 
  bind_rows()
```

```{r}
#'mutate time to numeric
data.segmented = data.segmented %>% 
              mutate(time = as.numeric(date)) %>% 
              dplyr::select(x,y, time, id.ht, seg)
#'merge with data
data = data %>% 
  mutate(id.ht = paste(id,ht,sep = ".")) %>% 
  left_join(data.segmented)
```


```{r}
#'plot segments
data %>% filter(id.ht == "151.005") %>% 
ggplot()+
  geom_path(aes(x = time, y = residence, col = as.factor(seg)))#+
  #facet_grid(id~ht, scales = "free")
```

```{r}
#'save segmented data as rdata and csv
save(data.segmented, file = "knots_data/foraging_segments.rdata")

write_csv(data.segmented, "knots_data/k01_foraging_segments.csv")
```

